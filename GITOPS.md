# GitOps Pull Agent –¥–ª—è Scoliologic Wiki

## –û–±–∑–æ—Ä

Pull Agent ‚Äî —ç—Ç–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è Scoliologic Wiki –∏–∑ GitHub —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è. –û–Ω —Ä–µ–∞–ª–∏–∑—É–µ—Ç –ø–∞—Ç—Ç–µ—Ä–Ω GitOps-lite, –≥–¥–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –∫ production-—Å—Ä–µ–¥–µ.

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê     ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê     ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                 ‚îÇ     ‚îÇ                 ‚îÇ     ‚îÇ                 ‚îÇ
‚îÇ  GitHub Repo    ‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ  Pull Agent     ‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ  Wiki App       ‚îÇ
‚îÇ                 ‚îÇ     ‚îÇ                 ‚îÇ     ‚îÇ                 ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò     ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò     ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
        ‚îÇ                       ‚îÇ                       ‚îÇ
        ‚îÇ                       ‚ñº                       ‚îÇ
        ‚îÇ               ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê             ‚îÇ
        ‚îÇ               ‚îÇ                 ‚îÇ             ‚îÇ
        ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ  Notifications  ‚îÇ‚óÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                        ‚îÇ  (TG/Slack)     ‚îÇ
                        ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

## –§—É–Ω–∫—Ü–∏–∏

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
- –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ GitHub —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç)
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π `git pull` –ø—Ä–∏ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–∏ –Ω–æ–≤—ã—Ö –∫–æ–º–º–∏—Ç–æ–≤
- –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –ø–µ—Ä–µ—Å–±–æ—Ä–∫–∏ (–∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ `package.json`)
- –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

### –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –æ—Ç–∫–∞—Ç –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö –¥–µ–ø–ª–æ—è
- –°–æ–∑–¥–∞–Ω–∏–µ –±—ç–∫–∞–ø–æ–≤ –ø–µ—Ä–µ–¥ –∫–∞–∂–¥—ã–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º
- –•—Ä–∞–Ω–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏ –¥–µ–ø–ª–æ–µ–≤

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
- –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Å—Ç–∞—Ç—É—Å–∞
- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤ Telegram –∏ Slack
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞

### 1. –í–∫–ª—é—á–µ–Ω–∏–µ –≤ Docker Compose

Pull Agent –≤–∫–ª—é—á–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ –ø—Ä–æ—Ñ–∏–ª—å `gitops`:

```bash
docker compose -f docker-compose.full.yml --profile gitops up -d
```

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

–î–æ–±–∞–≤—å—Ç–µ –≤ `.env`:

```env
# Git –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
GIT_REPO_URL=https://github.com/sileade/scoliologic-wiki.git
GIT_BRANCH=main
GIT_TOKEN=ghp_xxxxxxxxxxxx  # –î–ª—è –ø—Ä–∏–≤–∞—Ç–Ω—ã—Ö —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–≤

# –ò–Ω—Ç–µ—Ä–≤–∞–ª –ø—Ä–æ–≤–µ—Ä–∫–∏ (–≤ —Å–µ–∫—É–Ω–¥–∞—Ö)
PULL_INTERVAL=300

# –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –æ—Ç–∫–∞—Ç–∞
ROLLBACK_ON_FAILURE=true
KEEP_BACKUPS=5

# –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
TELEGRAM_BOT_TOKEN=your_bot_token
TELEGRAM_CHAT_ID=your_chat_id
SLACK_WEBHOOK_URL=https://hooks.slack.com/services/xxx
```

### 3. –ü–æ–ª—É—á–µ–Ω–∏–µ GitHub Token (–¥–ª—è –ø—Ä–∏–≤–∞—Ç–Ω—ã—Ö —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–≤)

1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ GitHub ‚Üí Settings ‚Üí Developer settings ‚Üí Personal access tokens
2. –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π —Ç–æ–∫–µ–Ω —Å –ø—Ä–∞–≤–∞–º–∏ `repo`
3. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Ç–æ–∫–µ–Ω –≤ `GIT_TOKEN`

## –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å

Pull Agent –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –Ω–∞ –ø–æ—Ä—Ç—É 8080:

- **–ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞**: `http://localhost:8080/` ‚Äî —Å—Ç–∞—Ç—É—Å –∏ –∏—Å—Ç–æ—Ä–∏—è –¥–µ–ø–ª–æ–µ–≤
- **API —Å—Ç–∞—Ç—É—Å–∞**: `http://localhost:8080/status` ‚Äî JSON —Å —Ç–µ–∫—É—â–∏–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º
- **–ò—Å—Ç–æ—Ä–∏—è**: `http://localhost:8080/history` ‚Äî –ø–æ—Å–ª–µ–¥–Ω–∏–µ –¥–µ–ø–ª–æ–∏
- **–ë—ç–∫–∞–ø—ã**: `http://localhost:8080/backups` ‚Äî —Å–ø–∏—Å–æ–∫ –±—ç–∫–∞–ø–æ–≤

### –†—É—á–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ

–í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –∫–Ω–æ–ø–∫–∏ –¥–ª—è —Ä—É—á–Ω–æ–≥–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è:

| –ö–Ω–æ–ø–∫–∞ | –û–ø–∏—Å–∞–Ω–∏–µ |
|--------|----------|
| üì• **Pull** | –¢–æ–ª—å–∫–æ `git pull` –±–µ–∑ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è |
| üöÄ **Pull & Deploy** | –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π + –¥–µ–ø–ª–æ–π (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–µ–∂–∏–º) |
| üîÑ **Restart** | –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –±–µ–∑ –ø–µ—Ä–µ—Å–±–æ—Ä–∫–∏ |
| üõ†Ô∏è **Rebuild** | –ü–æ–ª–Ω–∞—è –ø–µ—Ä–µ—Å–±–æ—Ä–∫–∞ Docker-–æ–±—Ä–∞–∑–∞ |

### –†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ API

```bash
# –¢–æ–ª—å–∫–æ git pull (–±–µ–∑ –¥–µ–ø–ª–æ—è)
curl -X POST http://localhost:8080/pull

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π –∏ –¥–µ–ø–ª–æ–π
curl -X POST http://localhost:8080/trigger

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (–±–µ–∑ –ø–µ—Ä–µ—Å–±–æ—Ä–∫–∏)
curl -X POST http://localhost:8080/deploy \
  -H "Content-Type: application/json" \
  -d '{"rebuild": false}'

# –ü–æ–ª–Ω–∞—è –ø–µ—Ä–µ—Å–±–æ—Ä–∫–∞
curl -X POST http://localhost:8080/rebuild
```

### –†—É—á–Ω–æ–π –æ—Ç–∫–∞—Ç

```bash
curl -X POST http://localhost:8080/rollback \
  -H "Content-Type: application/json" \
  -d '{"backupName": "backup-2026-01-16T12-00-00-abc12345"}'
```

## API Endpoints

| –ú–µ—Ç–æ–¥ | Endpoint | –û–ø–∏—Å–∞–Ω–∏–µ |
|-------|----------|----------|
| GET | `/health` | Health check |
| GET | `/status` | –¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å –∞–≥–µ–Ω—Ç–∞ |
| GET | `/history` | –ò—Å—Ç–æ—Ä–∏—è –¥–µ–ø–ª–æ–µ–≤ |
| GET | `/backups` | –°–ø–∏—Å–æ–∫ –±—ç–∫–∞–ø–æ–≤ |
| GET | `/logs` | –ü–æ—Å–ª–µ–¥–Ω–∏–µ –ª–æ–≥–∏ |
| POST | `/pull` | –¢–æ–ª—å–∫–æ git pull (–±–µ–∑ –¥–µ–ø–ª–æ—è) |
| POST | `/trigger` | –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π + –¥–µ–ø–ª–æ–π |
| POST | `/deploy` | –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫/–ø–µ—Ä–µ—Å–±–æ—Ä–∫–∞ (–±–µ–∑ pull) |
| POST | `/rebuild` | –ü–æ–ª–Ω–∞—è –ø–µ—Ä–µ—Å–±–æ—Ä–∫–∞ Docker-–æ–±—Ä–∞–∑–∞ |
| POST | `/rollback` | –û—Ç–∫–∞—Ç–∏—Ç—å –∫ –±—ç–∫–∞–ø—É |

## –ü—Ä–æ—Ü–µ—Å—Å –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

1. **–ü—Ä–æ–≤–µ—Ä–∫–∞** ‚Äî `git fetch` –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –Ω–æ–≤—ã—Ö –∫–æ–º–º–∏—Ç–∞—Ö
2. **–°—Ä–∞–≤–Ω–µ–Ω–∏–µ** ‚Äî —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –∏ —É–¥–∞–ª—ë–Ω–Ω–æ–≥–æ —Ö–µ—à–∞ –∫–æ–º–º–∏—Ç–∞
3. **–ë—ç–∫–∞–ø** ‚Äî —Å–æ–∑–¥–∞–Ω–∏–µ —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏ —Ç–µ–∫—É—â–µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è
4. **Pull** ‚Äî `git pull` –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π
5. **–ê–Ω–∞–ª–∏–∑** ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ `package.json`
6. **–°–±–æ—Ä–∫–∞** ‚Äî –ø–µ—Ä–µ—Å–±–æ—Ä–∫–∞ –æ–±—Ä–∞–∑–∞ (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ) –∏–ª–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫
7. **–ú–∏–≥—Ä–∞—Ü–∏–∏** ‚Äî –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π –ë–î
8. **–ü—Ä–æ–≤–µ—Ä–∫–∞** ‚Äî –æ–∂–∏–¥–∞–Ω–∏–µ healthy —Å—Ç–∞—Ç—É—Å–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
9. **–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ** ‚Äî –æ—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± —É—Å–ø–µ—Ö–µ/–æ—à–∏–±–∫–µ

## –û—Ç–∫–∞—Ç –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö

–ï—Å–ª–∏ –≤–∫–ª—é—á—ë–Ω `ROLLBACK_ON_FAILURE=true`, –∞–≥–µ–Ω—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–∫–∞—Ç–∏—Ç—Å—è –∫ –ø—Ä–µ–¥—ã–¥—É—â–µ–º—É —Å–æ—Å—Ç–æ—è–Ω–∏—é –ø—Ä–∏:

- –û—à–∏–±–∫–µ —Å–±–æ—Ä–∫–∏ Docker –æ–±—Ä–∞–∑–∞
- –û—à–∏–±–∫–µ –∑–∞–ø—É—Å–∫–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
- –ù–µ—É—Å–ø–µ—à–Ω–æ–º health check (–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ —Å—Ç–∞–ª–æ healthy)

## –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

### Telegram

–ê–≥–µ–Ω—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏—è —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ:
- ‚úÖ –£—Å–ø–µ—à–Ω—ã—Ö –¥–µ–ø–ª–æ—è—Ö (–∫–æ–º–º–∏—Ç, –∞–≤—Ç–æ—Ä, –≤—Ä–µ–º—è)
- ‚ùå –û—à–∏–±–∫–∞—Ö –¥–µ–ø–ª–æ—è (–ø—Ä–∏—á–∏–Ω–∞ –æ—à–∏–±–∫–∏)
- üîÑ –û—Ç–∫–∞—Ç–∞—Ö (–∫ –∫–∞–∫–æ–º—É –∫–æ–º–º–∏—Ç—É)

### Slack

–ê–Ω–∞–ª–æ–≥–∏—á–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —Å —Ü–≤–µ—Ç–æ–≤–æ–π –∏–Ω–¥–∏–∫–∞—Ü–∏–µ–π:
- –ó–µ–ª—ë–Ω—ã–π ‚Äî —É—Å–ø–µ—Ö
- –ö—Ä–∞—Å–Ω—ã–π ‚Äî –æ—à–∏–±–∫–∞

## –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–õ–æ–≥–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ `/app/logs/` —Å —Ä–æ—Ç–∞—Ü–∏–µ–π:
- –§–æ—Ä–º–∞—Ç: `pull-agent-YYYY-MM-DD.log`
- –•—Ä–∞–Ω–µ–Ω–∏–µ: 14 –¥–Ω–µ–π
- –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä: 20MB –Ω–∞ —Ñ–∞–π–ª

–ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤:

```bash
# –ß–µ—Ä–µ–∑ Docker
docker logs wiki-pull-agent -f

# –ß–µ—Ä–µ–∑ API
curl http://localhost:8080/logs?lines=100
```

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

1. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–æ–∫–µ–Ω—ã —Å –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–º–∏ –ø—Ä–∞–≤–∞–º–∏** ‚Äî —Ç–æ–ª—å–∫–æ `repo` –¥–ª—è –ø—Ä–∏–≤–∞—Ç–Ω—ã—Ö —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–≤
2. **–•—Ä–∞–Ω–∏—Ç–µ —Ç–æ–∫–µ–Ω—ã –≤ —Å–µ–∫—Ä–µ—Ç–∞—Ö** ‚Äî –Ω–µ –∫–æ–º–º–∏—Ç—å—Ç–µ –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
3. **–û–≥—Ä–∞–Ω–∏—á—å—Ç–µ –¥–æ—Å—Ç—É–ø –∫ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—É** ‚Äî –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ firewall –∏–ª–∏ reverse proxy
4. **–†–µ–≥—É–ª—è—Ä–Ω–æ —Ä–æ—Ç–∏—Ä—É–π—Ç–µ —Ç–æ–∫–µ–Ω—ã** ‚Äî –æ–±–Ω–æ–≤–ª—è–π—Ç–µ –∫–∞–∂–¥—ã–µ 90 –¥–Ω–µ–π

### –î–æ—Å—Ç—É–ø –∫ Docker Socket

Pull Agent —Ç—Ä–µ–±—É–µ—Ç –¥–æ—Å—Ç—É–ø –∫ Docker socket –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞–º–∏. –≠—Ç–æ –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–π —Ä–∏—Å–∫ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏. –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:

- –ó–∞–ø—É—Å–∫–∞–π—Ç–µ —Ç–æ–ª—å–∫–æ –≤ –¥–æ–≤–µ—Ä–µ–Ω–Ω–æ–π —Å—Ä–µ–¥–µ
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ Docker socket proxy –¥–ª—è –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–∞
- –†–∞—Å—Å–º–æ—Ç—Ä–∏—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ rootless Docker

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### Prometheus –º–µ—Ç—Ä–∏–∫–∏

Pull Agent —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç –º–µ—Ç—Ä–∏–∫–∏ –Ω–∞ `/metrics`:

- `pull_agent_checks_total` ‚Äî –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–æ–≤–µ—Ä–æ–∫
- `pull_agent_updates_total` ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π
- `pull_agent_errors_total` ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—à–∏–±–æ–∫
- `pull_agent_rollbacks_total` ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—Ç–∫–∞—Ç–æ–≤
- `pull_agent_last_check_timestamp` ‚Äî –≤—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–π –ø—Ä–æ–≤–µ—Ä–∫–∏

### Grafana –¥–∞—à–±–æ—Ä–¥

–î–æ–±–∞–≤—å—Ç–µ –≤ Grafana –¥–∞—à–±–æ—Ä–¥ –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞:

```json
{
  "title": "Pull Agent",
  "panels": [
    {
      "title": "Updates",
      "type": "stat",
      "targets": [{"expr": "pull_agent_updates_total"}]
    },
    {
      "title": "Errors",
      "type": "stat",
      "targets": [{"expr": "pull_agent_errors_total"}]
    }
  ]
}
```

## Troubleshooting

### –ê–≥–µ–Ω—Ç –Ω–µ –≤–∏–¥–∏—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å `GIT_REPO_URL` –∏ `GIT_BRANCH`
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ `GIT_TOKEN` –∏–º–µ–µ—Ç –¥–æ—Å—Ç—É–ø –∫ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—é
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏: `docker logs wiki-pull-agent`

### –û—à–∏–±–∫–∞ "Permission denied"

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –Ω–∞ Docker socket
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –∏–º–µ–µ—Ç –¥–æ—Å—Ç—É–ø –∫ `/var/run/docker.sock`

### –û—Ç–∫–∞—Ç –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞–ª–∏—á–∏–µ –±—ç–∫–∞–ø–æ–≤: `curl http://localhost:8080/backups`
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ `KEEP_BACKUPS > 0`
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –º–µ—Å—Ç–æ –Ω–∞ –¥–∏—Å–∫–µ –≤ volume `pull_agent_backups`

### –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –Ω–µ –ø—Ä–∏—Ö–æ–¥—è—Ç

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å `TELEGRAM_BOT_TOKEN` –∏ `TELEGRAM_CHAT_ID`
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –±–æ—Ç –¥–æ–±–∞–≤–ª–µ–Ω –≤ —á–∞—Ç
3. –î–ª—è Slack –ø—Ä–æ–≤–µ—Ä—å—Ç–µ webhook URL

## –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ë–∞–∑–æ–≤–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

```yaml
# docker-compose.override.yml
services:
  pull-agent:
    environment:
      GIT_REPO_URL: https://github.com/myorg/wiki.git
      GIT_BRANCH: main
      PULL_INTERVAL: 300
```

### –° –ø—Ä–∏–≤–∞—Ç–Ω—ã–º —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–º

```yaml
services:
  pull-agent:
    environment:
      GIT_REPO_URL: https://github.com/myorg/private-wiki.git
      GIT_TOKEN: ghp_xxxxxxxxxxxx
```

### –° —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è–º–∏

```yaml
services:
  pull-agent:
    environment:
      TELEGRAM_BOT_TOKEN: "123456:ABC-DEF"
      TELEGRAM_CHAT_ID: "-1001234567890"
```

## –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞–º–∏

| –§—É–Ω–∫—Ü–∏—è | Pull Agent | ArgoCD | Flux |
|---------|------------|--------|------|
| –°–ª–æ–∂–Ω–æ—Å—Ç—å | –ù–∏–∑–∫–∞—è | –í—ã—Å–æ–∫–∞—è | –°—Ä–µ–¥–Ω—è—è |
| Kubernetes | –ù–µ –Ω—É–∂–µ–Ω | –¢—Ä–µ–±—É–µ—Ç—Å—è | –¢—Ä–µ–±—É–µ—Ç—Å—è |
| –û—Ç–∫–∞—Ç | –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π | –†—É—á–Ω–æ–π | –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π |
| –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è | –í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ | –ü–ª–∞–≥–∏–Ω—ã | –ü–ª–∞–≥–∏–Ω—ã |
| –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å | –ü—Ä–æ—Å—Ç–æ–π | –ü–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–π | –ù–µ—Ç |

Pull Agent –∏–¥–µ–∞–ª—å–Ω–æ –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –Ω–µ–±–æ–ª—å—à–∏—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤, –≥–¥–µ –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–π Kubernetes –∏ GitOps-–∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞.
